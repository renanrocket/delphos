$.extend({	playSound: function(){		return $("<embed src='../"+arguments[0]+".mp3' hidden='true' style='display:none;' autostart='true' loop='false' class='playSound'>" + "<audio autoplay='autoplay' style='display:none;' controls='controls'><source src='../"+arguments[0]+".mp3' /><source src='../"+arguments[0]+".ogg' /></audio>").appendTo('body');	}});$(document).ready(function(){	var janelas = new Array();	var contatos = new Array();	$('#contatos ul li a').each(function(){		var link = $(this);		if(link.attr('id')!== undefined){			contatos.push(link.attr('id'));		}	});	function ajustarJanelas(){				var qtd_janelas = janelas.length;		var posicao;		for(var i = 0; i < janelas.length; i++){			if(janelas[i] === undefined){				janelas.splice(i, 1);				i--;			}			posicao = (i*206);			$('#jan_'+janelas[i]).attr('style', 'right:'+posicao+'px;');		}	}		function getCookie(cname) {	    var name = cname + "=";	    var ca = document.cookie.split(';');	    for(var i=0; i<ca.length; i++) {	        var c = ca[i];	        while (c.charAt(0)==' ') c = c.substring(1);	        if (c.indexOf(name) != -1) return c.substring(name.length,c.length);	    }	    return "";	}		function add_janelas(id, nome, imagem, posicao){		var html_add = '<div style="right:'+ posicao +'px;" class="janela" id="jan_'+id+'"><div class="topo" id="'+id+'"><span><a href="javascript:void(0);" id="fechar">X</a><img src="'+imagem+'"/> '+nome+'</span></div><div id="corpo"><div class="mensagens"><ul class="listar"></ul></div><input type="text" class="mensagem" id="'+id+'" maxlength="255" /></div></div>';		$('#janelas').append(html_add);	}	function abrir_janelas(x){		$('#contatos ul li a').each(function(){			var link = $(this);			var id = link.attr('id');			if(id == x && $('#jan_'+x).attr('class') == null){				link.click();				$.playSound('../chat/sounds/new');			}		});	}		function scroll_Down(){		var height = $('.mensagens ul.listar').scrollHeight;		$(".mensagens .listar").scrollTop(height);	}	var antes = -1;	var depois = 0;	function verificar(){		$.post('../chat/ajax/chat.php' , {acao: 'verificar', ids: janelas, contatos: contatos}, function(x){						if(x.nao_lidos !== ''){				var arr = x.nao_lidos;				for(var i in arr){					abrir_janelas(arr[i]);				}			}			if(janelas.length > 0){				var mens = x.mensagens;				if(mens !== ''){					for(i in mens){						var mensExistente = $('#jan_'+i+' ul.listar').html();						if(mensExistente != mens[i]){							$('#jan_'+i+' ul.listar').html(mens[i]);							var height = $('#jan_'+i+' ul.listar')[0].scrollHeight;							$('#jan_'+i+' ul.listar').scrollTop(height);							$.playSound('chat/sounds/new');						}					}				}			}			if(x.offline !== ''){				var arrOFF = x.offline;				for(i in arrOFF){					if($('#li_'+arrOFF[i]).attr('class')!='offline'){						$('#li_'+arrOFF[i]).addClass("offline");						$('#li_'+arrOFF[i]+' a .online').html("");						$('#li_'+arrOFF[i]).removeClass("online");					}				}			}						var contatos_online = 0;			if(x.online !== ''){				var arrON = x.online;				for(i in arrON){					if($('#li_'+arrON[i]).attr('class')!='online'){						$('#li_'+arrON[i]+' a .offline').html('<span class="online_span"></span>');						$('#li_'+arrON[i]).removeClass("offline");						$('#li_'+arrON[i]).addClass("online");					}					contatos_online++;				}				$('.contatos-topo div').html("Contatos "+ contatos_online);			}						depois += 1;					}, 'jSON');			}	verificar();			$('.janela').live('click', function(){		var id = $(this).children('.topo').attr('id');		$.post('../chat/ajax/chat.php',{acao: 'mudar_status', user: id});	});		$('.comecar').live('click', function(){		var id = $(this).attr('id');		var nome = $(this).attr('nome');		var imagem = $(this).attr('imagem');		janelas.push(id);		for(var i = 0; i < janelas.length; i++){			if(janelas[i] === undefined){				janelas.splice(i, 1);				i--;			}		}		var posicao = (i*206)-206;		add_janelas(id, nome, imagem, posicao);		$(this).removeClass('comecar');		return false;	});		$('a#fechar').live('click', function(){		var id = $(this).parent().parent().attr('id');		var parent = $(this).parent().parent().parent().hide();		$('#contatos a#'+id+'').addClass('comecar');				var n = janelas.length;		for(i = j = 0 ; i < n; i++){			if(janelas[i] !== undefined){								if(j===0){					j=1;				}				var posicao = (j*206)-206;				if(janelas[i] == id){					delete janelas[i];					document.cookie = "jan=;";					document.cookie = "janId=;";					document.cookie = "janNome=;";				}else{					$("#jan_"+janelas[i]).attr("style", "right:"+ posicao +"px;");					j++;				}			}		}	});	function esconder_mostrar_chat(){		if ($('.open').is(':hidden')){	    	document.cookie = "chat=0;";	    	$('.close').hide();	    	$('.open').show();	    	$('#contatos-ul').hide(100);	    	$('#contatos').addClass("fixar");	    	$('body').animate({	    		paddingRight: "0px"	    	}, 100);	    		    }else{	    	document.cookie = "chat=1;";	    	$('.close').show();	    	$('.open').hide();	    	$('#contatos-ul').show(100);	    	$('#contatos').removeClass("fixar");	    	$('body').animate({	    		paddingRight: "206px"	    	}, 100);	    		    }	}			$('.contatos-topo').live('click', function(){		esconder_mostrar_chat();	});			$('body').delegate('.topo', 'click', function(){		var pai = $(this).parent();		var isto = $(this);				if(pai.children('#corpo').is(':hidden')){			isto.removeClass('fixar');			pai.children('#corpo').toggle();		}else{			isto.addClass('fixar');			pai.children('#corpo').toggle();		}	});		$(window).bind('beforeunload', function() {		$.post('../chat/ajax/chat.php' , {acao: 'deslogar'});	});	setInterval(function(){				if(getCookie('chat')=='1'){			if(antes != depois){				verificar();			}			ajustarJanelas();		}	}, 2000);	setInterval(function(){				if(getCookie('chat')=='1'){			$.post('../chat/ajax/chat.php',{acao: 'turn_off', contatos: contatos});		}	}, 50000);	/**/});